#### **Контекст**

Для сервиса системы лояльности необходимо хранить и обрабатывать данные местоположения магазинов, участвующих в программе лояльности. Эти данные используются для фильтрации, например, в поиске ближайших магазинов к пользователю или для определения зон действия локальных акций. Эффективный поиск по географическим данным напрямую влияет на производительность приложения и качество пользовательского опыта (PER01, PER02).

Стандартные индексы, такие как B-tree, не подходят для обработки пространственных данных, так как они не поддерживают специализированные операции, такие как расчет расстояния между точками или пересечение географических зон.

---

#### **Решение**

**Использовать SP-GiST (Space-partitioned Generalized Search Tree)** индексы для хранения и обработки географических данных, связанных с местоположением магазинов.

SP-GiST позволяет эффективно разбивать пространство на области, что делает его подходящим для выполнения запросов, связанных с пространственными операциями (например, поиск ближайшего магазина или фильтрация магазинов по радиусу).

---

#### **Рассмотренные варианты**

1. **GiST (Generalized Search Tree)**
    
    - Подходит для большинства пространственных запросов, но менее эффективен для обработки точечных данных и в задачах, требующих разделения пространства.
2. **BRIN (Block Range Index)**
    
    - Подходит для работы с большими объемами данных, но менее эффективен при поиске конкретных объектов или выполнении сложных пространственных операций.
3. **SP-GiST (выбранное решение)**
    
    - Оптимизирован для задач, связанных с разделением пространства и поиска в ограниченных зонах.

---

#### **Последствия**

**Положительные:**

1. **Повышенная производительность**: Ускорение запросов по местоположению за счет оптимизации индексации пространственных данных.
2. **Улучшение пользовательского опыта**: Быстрый поиск ближайших магазинов и эффективная обработка зональных данных для акций.
3. **Масштабируемость**: SP-GiST хорошо работает с большим количеством пространственных объектов.

**Отрицательные:**

1. **Кривая обучения**: Команде потребуется изучить особенности работы со SP-GiST индексами.
2. **Увеличение времени настройки**: Настройка индексации и оптимизация запросов требует времени.